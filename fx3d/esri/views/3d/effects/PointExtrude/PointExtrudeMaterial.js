/**
 * Copyright @ 2021 Esri.
 * All rights reserved under the copyright laws of the United States and applicable international laws, treaties, and conventions.
 */
define(["dojo/text!./PointExtrudeMaterial.xml","dojo/_base/declare","esri/core/Accessor","../../webgl-engine-extensions/GLSLShader","../../webgl-engine-extensions/GLSLProgramExt","../../support/fx3dUtils","../Materials"],function(i,r,t,e,s,o,n){var a=r([n],{declaredClass:"esri.views.3d.effects.PointExtrude.PointExtrudeMaterial",constructor:function(i){this._gl=i.gl,this._shaderSnippets=i.shaderSnippets,this._program=null,this._pushState=i.pushState,this._restoreState=i.restoreState,this._viewingMode=i.viewingMode},destroy:function(){this._program&&(this._program.dispose(),delete this._program,this._program=null)},_addDefines:function(i,r){var t="";if(null!=r)if(Array.isArray(r))for(var e=0,s=r.length;e<s;e++){var o=r[e];t+="#define "+o+"\n"}else for(var o in r)t+="#define "+o+"\n";return this._shaderSnippets.defines+"\n"+t+i},loadShaders:function(){if(this._shaderSnippets){null!=this._shaderSnippets.pointExtrudeVS&&null!=this._shaderSnippets.pointExtrudeFS||this._shaderSnippets._parse(i);var r=[];"global"==this._viewingMode?r.push("GLOBAL"):r.push("LOCAL");var t=this._addDefines(this._shaderSnippets.pointExtrudeVS,r),o=new e(35633,t,this._gl),n=new e(35632,this._shaderSnippets.pointExtrudeFS,this._gl);this._program=new s([o,n],this._gl),this._program.init()}return this._initResources()},_initResources:function(){return!0},bind:function(i,r){this._program.use(),this._program.uniformMatrix4fv("ps",i.proj),this._program.uniform4fv("ei",i.viewport),this._program.uniform3fv("lp",i.lightingData.direction),this._program.uniform4fv("ss",i.lightingData.ambient),this._program.uniform4fv("so",i.lightingData.diffuse),this._program.uniform4fv("es",i.lightingData.specular),this._oldTex=this._gl.getParameter(32873);var t=this.getOldActiveUnit(r);i.mp.bind(t+1),this._program.uniform1i("mp",t+1),i.oi.bind(t+2),this._program.uniform1i("oi",t+2),this._program.uniform2fv("pp",i.pp),this._program.uniform2f("ls",i.ls,i.ee),this._program.uniform3fv("ms",i.ms),this._gl.activeTexture(33984+t+3),this._gl.bindTexture(3553,i.oo),this._program.uniform1i("oo",t+3),this._program.uniform1f("os",i.os),this._program.uniform1f("pm",i.pm),this._program.uniform3fv("pi",i.pi),this._program.uniform1f("is",i.time),this._program.uniform1i("li",i.reachedRepeatLimit),this._program.uniform1f("po",i.po),this._program.uniform1f("sl",i.zoom)},bindVec3f:function(i,r,t,e){this._program.uniform3f(i,r,t,e)},bindVec3fv:function(i,r){this._program.uniform3fv(i,r)},bindMat4:function(i,r){this._program.uniformMatrix4fv(i,r)},release:function(i){this._restoreState(i)}});return a});